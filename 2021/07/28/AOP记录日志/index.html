<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AOP记录日志 | LJC’sBlog</title>
    <meta name="description"
          content="AOP记录操作日志  使用aop记录日志，使用的是返回后通知。具体的实现如下：  1、新建数据库loginfo  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&#x2F;* Navicat Premium Data Transfer Source Serve">
    <meta name="keywords" content="Spring">
    <meta name="author" content="Hello World攻城狮">
    <meta name="copyright" content="Hello World攻城狮">
    <meta name="format-detection" content="telephone=no">
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="canonical" href="http://www.ljc.cn.com/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/">
    <meta http-equiv="Cache-Control" content="no-transform">
    <meta http-equiv="Cache-Control" content="no-siteapp">
    <link rel="preconnect" href="//cdn.jsdelivr.net"/>
    <link rel="preconnect" href="//hm.baidu.com"/>
    <link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/>
    <link rel="preconnect" href="//busuanzi.ibruce.info"/>
    <link rel="preconnect" href="//zz.bdstatic.com"/>
    <meta property="og:type" content="article">
    <meta property="og:title" content="AOP记录日志">
    <meta property="og:url"
          content="http://www.ljc.cn.com/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/">
    <meta property="og:site_name" content="LJC’sBlog">
    <meta property="og:description"
          content="AOP记录操作日志  使用aop记录日志，使用的是返回后通知。具体的实现如下：  1、新建数据库loginfo  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051&#x2F;* Navicat Premium Data Transfer Source Serve">
    <meta property="og:image" content="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/cover/bg16.jpg">
    <meta property="article:published_time" content="2021-07-28T03:10:46.000Z">
    <meta property="article:modified_time" content="2021-07-31T00:29:35.325Z">
    <meta name="twitter:card" content="summary">
    <script>var activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
            document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
        }
    }
    var activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
            document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
        }
    }

    var getCookies = function (name) {
        const value = `; ${document.cookie}`
        const parts = value.split(`; ${name}=`)
        if (parts.length === 2) return parts.pop().split(';').shift()
    }

    var autoChangeMode = 'false'
    var t = getCookies('theme')
    if (autoChangeMode === '1') {
        var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
        var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
        var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
        var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

        if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
                console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
                var now = new Date()
                var hour = now.getHours()
                var isNight = hour <= 6 || hour >= 18
                isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
                if (Cookies.get('theme') === undefined) {
                    e.matches ? activateDarkMode() : activateLightMode()
                }
            })
        } else if (t === 'light') activateLightMode()
        else activateDarkMode()
    } else if (autoChangeMode === '2') {
        now = new Date()
        hour = now.getHours()
        isNight = hour <= 6 || hour >= 18
        if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
        else if (t === 'light') activateLightMode()
        else activateDarkMode()
    } else {
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
    }</script>
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css">
    <link rel="prev" title="OpenFeign的使用"
          href="http://www.ljc.cn.com/2021/07/31/OpenFeign%E7%9A%84%E4%BD%BF%E7%94%A8/">
    <link rel="next" title="Nacos持久化配置"
          href="http://www.ljc.cn.com/2021/07/28/Nacos%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE/">
    <link rel="stylesheet" type="text/css"
          href="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.css">
    <script src="https://cdn.jsdelivr.net/npm/instantsearch.js@2.10.5/dist/instantsearch.min.js" defer></script>
    <script>var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?true";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
    </script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap">
    <script>var GLOBAL_CONFIG = {
        root: '/',
        algolia: {
            "appId": "VFLGY3NZZ8",
            "apiKey": "9082a51b290f5be0d72a453a5e7d71a5",
            "indexName": "ljc",
            "hits": {"per_page": 7},
            "languages": {
                "input_placeholder": "搜索文章",
                "hits_empty": "找不到您查询的内容:${query}",
                "hits_stats": "找到 ${hits} 条结果，用时 ${time} 毫秒"
            }
        },
        localSearch: {"path": "search.xml", "languages": {"hits_empty": "找不到您查询的内容:${query}"}},
        translate: {
            "defaultEncoding": 2,
            "translateDelay": 0,
            "msgToTraditionalChinese": "繁",
            "msgToSimplifiedChinese": "簡"
        },
        noticeOutdate: {
            "limitDay": 500,
            "position": "top",
            "messagePrev": "It has been",
            "messageNext": "days since the last update, the content of the article may be outdated."
        },
        copy: {
            success: '复制成功',
            error: '复制错误',
            noSupport: '浏览器不支持'
        },
        bookmark: {
            message_prev: '按',
            message_next: '键将本页加入书签'
        },
        runtime_unit: '天',
        runtime: true,
        copyright: undefined,
        ClickShowText: undefined,
        medium_zoom: true,
        fancybox: true,
        Snackbar: {
            "bookmark": {"message_prev": "按", "message_next": "键将本页加入书签"},
            "chs_to_cht": "你已切换为繁体",
            "cht_to_chs": "你已切换为简体",
            "day_to_night": "你已切换为深色模式",
            "night_to_day": "你已切换为浅色模式",
            "bgLight": "#49b1f5",
            "bgDark": "#121212",
            "position": "top-center"
        },
        justifiedGallery: {
            js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
            css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
        },
        baiduPush: true,
        highlightCopy: true,
        highlightLang: true,
        isPhotoFigcaption: true,
        islazyload: true,
        isanchor: true
    }</script>
    <script>var GLOBAL_CONFIG_SITE = {
        isPost: true,
        isHome: false,
        isHighlightShrink: false,
        isSidebar: true,
        postUpdate: '2021-07-31 08:29:35'
    }</script>
    <noscript>
        <style>
            #nav {
                opacity: 1
            }

            .justified-gallery img {
                opacity: 1
            }
        </style>
    </noscript>
    <link rel="stylesheet" href="/css/VolantisTags.css">
    <link rel="stylesheet" href="/css/volantis.css">
    <link rel="stylesheet" href="/css/fontAnimation.css">
    <link rel="stylesheet" type="text/css"
          href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/mainColor/heoMainColor.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/gh/zhheo/JS-Heo@main/poem/poem.css">
    <meta name="generator" content="Hexo 4.2.1">
</head>
<body>
<div id="loading-box">
    <div class="loading-left-bg"></div>
    <div class="loading-right-bg"></div>
    <div class="spinner-box">
        <div class="configure-border-1">
            <div class="configure-core"></div>
        </div>
        <div class="configure-border-2">
            <div class="configure-core"></div>
        </div>
        <div class="loading-word">加载中...</div>
    </div>
</div>
<div id="mobile-sidebar">
    <div id="menu_mask"></div>
    <div id="mobile-sidebar-menus">
        <div class="mobile_author_icon"><img class="avatar-img" src="/img/avatar.png"
                                             onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div>
        <div class="mobile_post_data">
            <div class="mobile_data_item is-center">
                <div class="mobile_data_link"><a href="/archives/">
                    <div class="headline">文章</div>
                    <div class="length_num">31</div>
                </a></div>
            </div>
            <div class="mobile_data_item is-center">
                <div class="mobile_data_link"><a href="/tags/">
                    <div class="headline">标签</div>
                    <div class="length_num">12</div>
                </a></div>
            </div>
        </div>
        <hr/>
        <div class="menus_items">
            <div class="menus_item"><a class="site-page" href="/"><i
                    class="fa-fw fas fa-home"></i><span> 主页</span></a></div>
            <div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a>
            </div>
            <div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a>
            </div>
            <div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 远方杂谈</span><i
                    class="fas fa-chevron-down menus-expand"></i></a>
                <ul class="menus_item_child">
                    <li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a>
                    </li>
                </ul>
            </div>
            <div class="menus_item"><a class="site-page" href="/about/"><i
                    class="fa-fw fas fa-heart"></i><span> 关于我的</span></a></div>
        </div>
    </div>
</div>
<i class="fas fa-arrow-right on" id="toggle-sidebar"></i>
<div id="sidebar">
    <div class="sidebar-toc">
        <div class="sidebar-toc__title">目录</div>
        <div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span
                class="progress-percentage">%</span>
            <div class="sidebar-toc__progress-bar"></div>
        </div>
        <div class="sidebar-toc__content">
            <ol class="toc">
                <li class="toc-item toc-level-2"><a class="toc-link" href="#联系博主"><span class="toc-number">1.</span>
                    <span class="toc-text">联系博主</span></a></li>
            </ol>
        </div>
    </div>
</div>
<div id="body-wrap">
    <div id="web_bg" data-type="photo"></div>
    <header class="post-bg" id="page-header"
            style="background-image: url(https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/cover/bg16.jpg)">
        <nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">LJC’sBlog</a></span><span
                class="pull-right menus"><div id="search_button"><a class="site-page social-icon search"><i
                class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div
                class="menus_item"><a class="site-page" href="/"><i
                class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page"
                                                                                                   href="/archives/"><i
                class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page"
                                                                                                       href="/tags/"><i
                class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page"><i
                class="fa-fw fas fa-list"></i><span> 远方杂谈</span><i class="fas fa-chevron-down menus-expand"></i></a><ul
                class="menus_item_child"><li><a class="site-page" href="/music/"><i
                class="fa-fw fas fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a
                class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于我的</span></a></div></div><span
                class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav>
        <div id="post-info">
            <div id="post-title">
                <div class="posttitle">AOP记录日志</div>
            </div>
            <div id="post-meta">
                <div class="meta-firstline">
                    <time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-07-28 11:10:46"><i
                            class="far fa-calendar-alt fa-fw"></i> 发表于 2021-07-28</span><span
                            class="post-meta__separator">|</span><span class="post-meta__date-updated"
                                                                       title="更新于 2021-07-31 08:29:35"><i
                            class="fas fa-history fa-fw"></i> 更新于 2021-07-31</span></time>
                </div>
                <div class="meta-secondline"><span class="post-meta-wordcount"><i
                        class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">4.4k</span><span
                        class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 23 分钟</span></span>
                </div>
                <div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i
                        class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span
                        id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span><span
                        class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a
                        href="/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/#post-comment"
                        itemprop="discussionUrl"><span class="valine-comment-count comment-count"
                                                       data-xid="/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/"
                                                       itemprop="commentCount"></span></a></div>
            </div>
        </div>
    </header>
    <main class="layout_post" id="content-inner">
        <article id="post">
            <div class="post-content" id="article-container"><p class='p center logo large'>AOP记录操作日志</p>

                <p class='p small'>使用aop记录日志，使用的是返回后通知。具体的实现如下：</p>

                <p class='p small'>1、新建数据库loginfo</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">&#x2F;*</span><br><span class="line"> Navicat Premium Data Transfer</span><br><span
                                        class="line"></span><br><span
                                        class="line"> Source Server         : 本地</span><br><span class="line"> Source Server Type    : MySQL</span><br><span
                                        class="line"> Source Server Version : 80018</span><br><span class="line"> Source Host           : 127.0.0.1:3306</span><br><span
                                        class="line"> Source Schema         : 218</span><br><span
                                        class="line"></span><br><span class="line"> Target Server Type    : MySQL</span><br><span
                                        class="line"> Target Server Version : 80018</span><br><span class="line"> File Encoding         : 65001</span><br><span
                                        class="line"></span><br><span
                                        class="line"> Date: 28&#x2F;07&#x2F;2021 16:28:36</span><br><span class="line">*&#x2F;</span><br><span
                                        class="line"></span><br><span class="line">SET NAMES utf8mb4;</span><br><span
                                        class="line">SET FOREIGN_KEY_CHECKS &#x3D; 0;</span><br><span
                                        class="line"></span><br><span
                                        class="line">-- ----------------------------</span><br><span class="line">-- Table structure for log</span><br><span
                                        class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;log&#96;;</span><br><span
                                        class="line">CREATE TABLE &#96;log&#96;  (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span
                                        class="line">  &#96;userId&#96; int(11) NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;userName&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;module&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;method&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;beforeParams&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;operateParams&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;startTime&#96; datetime(0) NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;endTime&#96; datetime(0) NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;time&#96; varchar(11) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;userIp&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;resultStatus&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  &#96;resultMsg&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  PRIMARY KEY (&#96;id&#96;) USING BTREE</span><br><span
                                        class="line">) ENGINE &#x3D; InnoDB CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span
                                        class="line"></span><br><span
                                        class="line">-- ----------------------------</span><br><span class="line">-- Table structure for user</span><br><span
                                        class="line">-- ----------------------------</span><br><span class="line">DROP TABLE IF EXISTS &#96;user&#96;;</span><br><span
                                        class="line">CREATE TABLE &#96;user&#96;  (</span><br><span class="line">  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,</span><br><span
                                        class="line">  &#96;name&#96; varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NULL DEFAULT NULL,</span><br><span
                                        class="line">  PRIMARY KEY (&#96;id&#96;) USING BTREE</span><br><span
                                        class="line">) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 3 CHARACTER SET &#x3D; utf8mb4 COLLATE &#x3D; utf8mb4_general_ci ROW_FORMAT &#x3D; Dynamic;</span><br><span
                                        class="line"></span><br><span
                                        class="line">SET FOREIGN_KEY_CHECKS &#x3D; 1;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>2、新建logInfo的maven项目并导入依赖</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br><span class="line">52</span><br><span
                                        class="line">53</span><br><span class="line">54</span><br><span
                                        class="line">55</span><br><span class="line">56</span><br><span
                                        class="line">57</span><br><span class="line">58</span><br><span
                                        class="line">59</span><br><span class="line">60</span><br><span
                                        class="line">61</span><br><span class="line">62</span><br><span
                                        class="line">63</span><br><span class="line">64</span><br><span
                                        class="line">65</span><br><span class="line">66</span><br><span
                                        class="line">67</span><br><span class="line">68</span><br><span
                                        class="line">69</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">			&lt;version&gt;3.4.0&lt;&#x2F;version&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.apache.commons&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;commons-lang3&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;fastjson&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">			&lt;version&gt;1.2.75&lt;&#x2F;version&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;spring-boot-starter-aop&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">			&lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">			&lt;scope&gt;test&lt;&#x2F;scope&gt;</span><br><span
                                        class="line">			&lt;exclusions&gt;</span><br><span class="line">				&lt;exclusion&gt;</span><br><span
                                        class="line">					&lt;groupId&gt;org.junit.vintage&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">					&lt;artifactId&gt;junit-vintage-engine&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">				&lt;&#x2F;exclusion&gt;</span><br><span
                                        class="line">			&lt;&#x2F;exclusions&gt;</span><br><span class="line">		&lt;&#x2F;dependency&gt;</span><br><span
                                        class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.httpcomponents&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">            &lt;artifactId&gt;httpclient&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">            &lt;version&gt;4.5.12&lt;&#x2F;version&gt;</span><br><span
                                        class="line">        &lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;org.assertj&lt;&#x2F;groupId&gt;</span><br><span
                                        class="line">			&lt;artifactId&gt;assertj-core&lt;&#x2F;artifactId&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span
                                        class="line">			&lt;groupId&gt;</span><br><span class="line">				org.springframework.boot</span><br><span
                                        class="line">			&lt;&#x2F;groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;</span><br><span
                                        class="line">				spring-boot-dependencies</span><br><span
                                        class="line">			&lt;&#x2F;artifactId&gt;</span><br><span class="line">			&lt;version&gt;2.3.7.RELEASE</span><br><span
                                        class="line">			&lt;&#x2F;version&gt;</span><br><span class="line">			&lt;type&gt;pom&lt;&#x2F;type&gt;</span><br><span
                                        class="line">			&lt;scope&gt;import&lt;&#x2F;scope&gt;</span><br><span
                                        class="line">		&lt;&#x2F;dependency&gt;</span><br><span class="line">	&lt;&#x2F;dependencies&gt;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>3、新建application.yaml</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">server:</span><br><span
                                        class="line">  port: 8080</span><br><span class="line">spring:</span><br><span
                                        class="line">  datasource:</span><br><span
                                        class="line">    username: root</span><br><span class="line">    password: 123456</span><br><span
                                        class="line">    driverClassName: com.mysql.cj.jdbc.Driver</span><br><span
                                        class="line">    url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;loginfo?useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf8&amp;serverTimezone&#x3D;Asia&#x2F;Shanghai</span><br><span
                                        class="line">    type: com.zaxxer.hikari.HikariDataSource</span><br><span
                                        class="line">    hikari:</span><br><span
                                        class="line">      #最小空闲链接数</span><br><span
                                        class="line">      minimumIdle: 5</span><br><span
                                        class="line">      #最大链接数</span><br><span
                                        class="line">      maximumPoolSize: 50</span><br><span class="line">      #最大生命周期</span><br><span
                                        class="line">      maxLifetime: 180000</span><br><span class="line">      #最长闲置时间</span><br><span
                                        class="line">      idleTimeout: 60000</span><br><span class="line">      #等待连接池的最大毫秒数</span><br><span
                                        class="line">      connectionTimeout: 20000</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>4、新建LoginfoApplication主启动类</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span
                                        class="line">import org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span
                                        class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span
                                        class="line"></span><br><span
                                        class="line">@SpringBootApplication</span><br><span class="line">public class LoginfoApplication &#123;</span><br><span
                                        class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span
                                        class="line">    SpringApplication.run(LoginfoApplication.class, args);</span><br><span
                                        class="line">  &#125;</span><br><span class="line">  </span><br><span
                                        class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>5、新建测试数据的User实体类</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span
                                        class="line">import com.baomidou.mybatisplus.annotation.IdType;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableField;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableId;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableName;</span><br><span
                                        class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span
                                        class="line">import lombok.NoArgsConstructor;</span><br><span
                                        class="line"></span><br><span
                                        class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span
                                        class="line"></span><br><span class="line">@Data</span><br><span class="line">@TableName(value &#x3D; &quot;user&quot;)</span><br><span
                                        class="line">@AllArgsConstructor</span><br><span
                                        class="line">@NoArgsConstructor</span><br><span class="line">public class User implements Serializable &#123;</span><br><span
                                        class="line">  @TableId(value &#x3D; &quot;id&quot;, type &#x3D; IdType.NONE)</span><br><span
                                        class="line">  private Integer id;</span><br><span class="line"></span><br><span
                                        class="line">  @TableField(value &#x3D; &quot;name&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String name;</span><br><span
                                        class="line">  </span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>6、新建Log实体类</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br><span class="line">52</span><br><span
                                        class="line">53</span><br><span class="line">54</span><br><span
                                        class="line">55</span><br><span class="line">56</span><br><span
                                        class="line">57</span><br><span class="line">58</span><br><span
                                        class="line">59</span><br><span class="line">60</span><br><span
                                        class="line">61</span><br><span class="line">62</span><br><span
                                        class="line">63</span><br><span class="line">64</span><br><span
                                        class="line">65</span><br><span class="line">66</span><br><span
                                        class="line">67</span><br><span class="line">68</span><br><span
                                        class="line">69</span><br><span class="line">70</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.IdType;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableField;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableId;</span><br><span
                                        class="line">import com.baomidou.mybatisplus.annotation.TableName;</span><br><span
                                        class="line">import lombok.AllArgsConstructor;</span><br><span class="line">import lombok.Data;</span><br><span
                                        class="line">import lombok.NoArgsConstructor;</span><br><span class="line">import lombok.experimental.Accessors;</span><br><span
                                        class="line"></span><br><span
                                        class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span
                                        class="line"></span><br><span class="line">@Data</span><br><span class="line">@AllArgsConstructor</span><br><span
                                        class="line">@NoArgsConstructor</span><br><span class="line">@TableName(value &#x3D; &quot;log&quot;)</span><br><span
                                        class="line">public class Log implements Serializable &#123;</span><br><span
                                        class="line">  @TableId(value &#x3D; &quot;id&quot;, type &#x3D; IdType.AUTO)</span><br><span
                                        class="line">  private long id;</span><br><span class="line"></span><br><span
                                        class="line">  &#x2F;** 用户id *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;userId&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private int userId;</span><br><span class="line"></span><br><span
                                        class="line">  &#x2F;** 用户名称 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;userName&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String userName;</span><br><span class="line"></span><br><span
                                        class="line">  &#x2F;** 操作模块 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;module&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String module;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 操作类型 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;method&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String method;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 操作前参数 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;beforeParams&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String beforeParams;</span><br><span class="line"></span><br><span
                                        class="line">  &#x2F;** 操作时请求参数 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;operateParams&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String operateParams;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 开始时间 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;startTime&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private Date startTime;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 结束时间 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;endTime&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private Date endTime;</span><br><span
                                        class="line"></span><br><span class="line">  &#x2F;** 共耗时(ms) *&#x2F;</span><br><span
                                        class="line">  @TableField(value &#x3D; &quot;time&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String time;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 用户IP *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;userIp&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String userIp;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 操作状态描述 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;resultStatus&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private int resultStatus;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 操作结果描述 *&#x2F;</span><br><span class="line">  @TableField(value &#x3D; &quot;resultMsg&quot;, exist &#x3D; true)</span><br><span
                                        class="line">  private String resultMsg;</span><br><span
                                        class="line">  </span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>7、新建UserMapper和LogMapper</p>

                <p class='p small'>UserMapper：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">package com.example.demo.mapper;</span><br><span
                                        class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span
                                        class="line">import com.example.demo.entity.User;</span><br><span class="line">import org.apache.ibatis.annotations.Mapper;</span><br><span
                                        class="line"></span><br><span class="line">@Mapper</span><br><span class="line">public interface Usermapper extends BaseMapper&lt;User&gt; &#123;</span><br><span
                                        class="line"></span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>LogMapper：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">package com.example.demo.mapper;</span><br><span
                                        class="line"></span><br><span class="line">import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span
                                        class="line">import com.example.demo.entity.Log;</span><br><span class="line">import org.apache.ibatis.annotations.Mapper;</span><br><span
                                        class="line"></span><br><span class="line">@Mapper</span><br><span class="line">public interface LogMapper extends BaseMapper&lt;Log&gt; &#123;</span><br><span
                                        class="line">    </span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>8、新建UserService和UserServiceImpl</p>
                <p class='p small'>Userservice：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"></span><br><span class="line">import com.example.demo.entity.User;</span><br><span
                                        class="line"></span><br><span class="line"></span><br><span class="line">public interface UserService &#123;</span><br><span
                                        class="line">  public User selectById(int id);</span><br><span
                                        class="line"></span><br><span
                                        class="line">  public void updateById(User d);</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>UserServiceImpl：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line"></span><br><span class="line">import com.example.demo.entity.User;</span><br><span
                                        class="line">import com.example.demo.mapper.Usermapper;</span><br><span
                                        class="line">import com.example.demo.service.UserService;</span><br><span
                                        class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span
                                        class="line">import org.springframework.stereotype.Service;</span><br><span
                                        class="line"></span><br><span class="line"></span><br><span class="line">@Service(&quot;DserviceImpl&quot;)</span><br><span
                                        class="line">public class UserServiceImpl implements UserService &#123;</span><br><span
                                        class="line">  @Autowired</span><br><span
                                        class="line">  Usermapper dmapper;</span><br><span class="line"></span><br><span
                                        class="line">  @Override</span><br><span class="line">  public User selectById(int id) &#123;</span><br><span
                                        class="line">    return dmapper.selectById(id);</span><br><span class="line">  &#125;</span><br><span
                                        class="line"></span><br><span class="line">  @Override</span><br><span
                                        class="line">  public void updateById(User d) &#123;</span><br><span
                                        class="line">    dmapper.updateById(d);</span><br><span
                                        class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>9、新建自定义注解SystemControllerLog</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">import java.lang.annotation.*;</span><br><span
                                        class="line"></span><br><span class="line">@Target(&#123;ElementType.PARAMETER, ElementType.METHOD&#125;)</span><br><span
                                        class="line">@Retention(RetentionPolicy.RUNTIME)</span><br><span class="line">@Documented</span><br><span
                                        class="line">public @interface SystemControllerLog &#123;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 查询模块 *&#x2F;</span><br><span class="line">  String module() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 查询模块名称 *&#x2F;</span><br><span class="line">  String methods() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 查询的bean名称 *&#x2F;</span><br><span class="line">  String serviceClass() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 查询单个详情的bean的方法 *&#x2F;</span><br><span class="line">  String queryMethod() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 查询详情的参数类型 *&#x2F;</span><br><span class="line">  String parameterType() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span class="line">  &#x2F;** 从页面参数中解析出要查询的id， 如域名修改中要从参数中获取customerDomainId的值进行查询 *&#x2F;</span><br><span
                                        class="line">  String parameterKey() default &quot;&quot;;</span><br><span
                                        class="line"></span><br><span
                                        class="line">  &#x2F;** 是否为批量类型操作 *&#x2F;</span><br><span class="line">  boolean paramIsArray() default false;</span><br><span
                                        class="line">  </span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>10、新建工具包R，HttpRequestUtil，SpringContextUtil</p>

                <p class='p small'>R：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br><span class="line">52</span><br><span
                                        class="line">53</span><br><span class="line">54</span><br><span
                                        class="line">55</span><br><span class="line">56</span><br><span
                                        class="line">57</span><br><span class="line">58</span><br><span
                                        class="line">59</span><br><span class="line">60</span><br><span
                                        class="line">61</span><br><span class="line">62</span><br><span
                                        class="line">63</span><br><span class="line">64</span><br><span
                                        class="line">65</span><br><span class="line">66</span><br><span
                                        class="line">67</span><br><span class="line">68</span><br><span
                                        class="line">69</span><br><span class="line">70</span><br><span
                                        class="line">71</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">import org.apache.http.HttpStatus;</span><br><span
                                        class="line"></span><br><span
                                        class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span
                                        class="line"></span><br><span class="line">public class R extends HashMap&lt;String, Object&gt; &#123;</span><br><span
                                        class="line">  private static final long serialVersionUID &#x3D; 1L;</span><br><span
                                        class="line"></span><br><span class="line">  public R() &#123;</span><br><span
                                        class="line">    put(&quot;code&quot;, 0);</span><br><span class="line">    put(&quot;msg&quot;, &quot;success&quot;);</span><br><span
                                        class="line">    put(&quot;data&quot;, &quot;&quot;);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static R error() &#123;</span><br><span class="line">    return R.error(HttpStatus.SC_INTERNAL_SERVER_ERROR, &quot;未知异常，请联系管理员&quot;);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static R error(String msg) &#123;</span><br><span
                                        class="line">    return R.error(HttpStatus.SC_INTERNAL_SERVER_ERROR, msg);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static R error(int code, String msg) &#123;</span><br><span
                                        class="line">    R r &#x3D; new R();</span><br><span class="line">    r.put(&quot;code&quot;, code);</span><br><span
                                        class="line">    r.put(&quot;msg&quot;, msg);</span><br><span class="line">    r.put(&quot;data&quot;, &quot;&quot;);</span><br><span
                                        class="line">    return r;</span><br><span class="line">  &#125;</span><br><span
                                        class="line"></span><br><span class="line">  public static R error(int code, String msg, Map&lt;Integer, Object&gt; map) &#123;</span><br><span
                                        class="line">    R r &#x3D; new R();</span><br><span class="line">    r.put(&quot;code&quot;, code);</span><br><span
                                        class="line">    r.put(&quot;msg&quot;, msg);</span><br><span class="line">    r.put(&quot;data&quot;, map);</span><br><span
                                        class="line">    return r;</span><br><span class="line">  &#125;</span><br><span
                                        class="line"></span><br><span class="line">  public static R ok(String msg) &#123;</span><br><span
                                        class="line">    R r &#x3D; new R();</span><br><span class="line">    r.put(&quot;msg&quot;, msg);</span><br><span
                                        class="line">    r.put(&quot;data&quot;, &quot;&quot;);</span><br><span
                                        class="line">    return r;</span><br><span class="line">  &#125;</span><br><span
                                        class="line"></span><br><span class="line">  public static R ok(String key, Object value) &#123;</span><br><span
                                        class="line">    R r &#x3D; new R();</span><br><span class="line">    Map&lt;String, Object&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span
                                        class="line">    map.put(key, value);</span><br><span class="line">    System.out.println(value);</span><br><span
                                        class="line">    r.put(&quot;data&quot;, map);</span><br><span class="line">    return r;</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static R ok() &#123;</span><br><span class="line">    return new R();</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static R ok(int code) &#123;</span><br><span class="line">    R r &#x3D; new R();</span><br><span
                                        class="line">    r.put(&quot;code&quot;, code);</span><br><span class="line">    return r;</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  @Override</span><br><span class="line">  public R put(String key, Object value) &#123;</span><br><span
                                        class="line">    super.put(key, value);</span><br><span class="line">    return this;</span><br><span
                                        class="line">  &#125;</span><br><span class="line">  </span><br><span
                                        class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>HttpRequestUtil：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br><span class="line">52</span><br><span
                                        class="line">53</span><br><span class="line">54</span><br><span
                                        class="line">55</span><br><span class="line">56</span><br><span
                                        class="line">57</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.http.HttpEntity;</span><br><span
                                        class="line">import org.apache.http.client.ClientProtocolException;</span><br><span
                                        class="line">import org.apache.http.client.config.RequestConfig;</span><br><span
                                        class="line">import org.apache.http.client.methods.*;</span><br><span
                                        class="line">import org.apache.http.entity.StringEntity;</span><br><span
                                        class="line">import org.apache.http.impl.client.CloseableHttpClient;</span><br><span
                                        class="line">import org.apache.http.impl.client.HttpClients;</span><br><span
                                        class="line">import org.apache.http.util.EntityUtils;</span><br><span
                                        class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span
                                        class="line">import java.io.IOException;</span><br><span class="line">import java.net.InetAddress;</span><br><span
                                        class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">public class HttpRequestUtil &#123;</span><br><span
                                        class="line"></span><br><span class="line">    &#x2F;**</span><br><span
                                        class="line">     * getIpAddr:(获取ip). &lt;br&#x2F;&gt;</span><br><span
                                        class="line">     *</span><br><span
                                        class="line">     * @param request</span><br><span
                                        class="line">     * @return</span><br><span class="line">     * @author fenglanglang</span><br><span
                                        class="line">     *&#x2F;</span><br><span class="line">    public static String getIpAddr(HttpServletRequest request) &#123;</span><br><span
                                        class="line">        String ipAddress &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span
                                        class="line">            ipAddress &#x3D; request.getHeader(&quot;x-forwarded-for&quot;);</span><br><span
                                        class="line">            if (ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span
                                        class="line">                ipAddress &#x3D; request.getHeader(&quot;Proxy-Client-IP&quot;);</span><br><span
                                        class="line">            &#125;</span><br><span class="line">            if (ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span
                                        class="line">                ipAddress &#x3D; request.getHeader(&quot;WL-Proxy-Client-IP&quot;);</span><br><span
                                        class="line">            &#125;</span><br><span class="line">            if (ipAddress &#x3D;&#x3D; null || ipAddress.length() &#x3D;&#x3D; 0 || &quot;unknown&quot;.equalsIgnoreCase(ipAddress)) &#123;</span><br><span
                                        class="line">                ipAddress &#x3D; request.getRemoteAddr();</span><br><span
                                        class="line">                if (ipAddress.equals(&quot;0:0:0:0:0:0:0:1&quot;)) &#123;</span><br><span
                                        class="line">                    ipAddress &#x3D; &quot;127.0.0.1&quot;;</span><br><span
                                        class="line">                &#125;</span><br><span class="line">                if (ipAddress.equals(&quot;127.0.0.1&quot;)) &#123;</span><br><span
                                        class="line">                    &#x2F;&#x2F; 根据网卡取本机配置的IP</span><br><span
                                        class="line">                    InetAddress inet &#x3D; InetAddress.getLocalHost();</span><br><span
                                        class="line">                    ipAddress &#x3D; inet.getHostAddress();</span><br><span
                                        class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span
                                        class="line">            &#x2F;&#x2F; 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照&#39;,&#39;分割</span><br><span
                                        class="line">            if (ipAddress !&#x3D; null &amp;&amp; ipAddress.length() &gt; 15) &#123;</span><br><span
                                        class="line">                if (ipAddress.indexOf(&quot;,&quot;) &gt; 0) &#123;</span><br><span
                                        class="line">                    ipAddress &#x3D; ipAddress.substring(0, ipAddress.indexOf(&quot;,&quot;));</span><br><span
                                        class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span
                                        class="line">        &#125; catch (Exception e) &#123;</span><br><span
                                        class="line">            ipAddress &#x3D; &quot;&quot;;</span><br><span
                                        class="line">        &#125;</span><br><span class="line">        return ipAddress;</span><br><span
                                        class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>SpringContextUtil：</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">import org.springframework.beans.BeansException;</span><br><span
                                        class="line">import org.springframework.context.ApplicationContext;</span><br><span
                                        class="line">import org.springframework.context.ApplicationContextAware;</span><br><span
                                        class="line">import org.springframework.stereotype.Component;</span><br><span
                                        class="line"></span><br><span class="line">&#x2F;** 获取spring容器，以访问容器中定义的其他bean *&#x2F;</span><br><span
                                        class="line">@Component</span><br><span class="line">public class SpringContextUtil implements ApplicationContextAware &#123;</span><br><span
                                        class="line"></span><br><span class="line">  private static ApplicationContext applicationContext;</span><br><span
                                        class="line"></span><br><span class="line">  &#x2F;** 实现ApplicationContextAware接口的回调方法，设置上下文环境 *&#x2F;</span><br><span
                                        class="line">  @Override</span><br><span class="line">  public void setApplicationContext(ApplicationContext applicationContext) &#123;</span><br><span
                                        class="line">    SpringContextUtil.applicationContext &#x3D; applicationContext;</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  public static ApplicationContext getApplicationContext() &#123;</span><br><span
                                        class="line">    return SpringContextUtil.applicationContext;</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  &#x2F;**</span><br><span class="line">   * 获取对象</span><br><span
                                        class="line">   *</span><br><span class="line">   * @return Object 一个以所给名字注册的bean的实例 (service注解方式，自动生成以首字母小写的类名为bean name)</span><br><span
                                        class="line">   *&#x2F;</span><br><span class="line">  public static Object getBean(String name) throws BeansException &#123;</span><br><span
                                        class="line">    return SpringContextUtil.applicationContext.getBean(name);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>11、新建LogController</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">package com.example.demo.controller;</span><br><span
                                        class="line"></span><br><span
                                        class="line">import com.example.demo.entity.User;</span><br><span class="line">import com.example.demo.log.SystemControllerLog;</span><br><span
                                        class="line">import com.example.demo.mapper.Usermapper;</span><br><span
                                        class="line">import com.example.demo.service.impl.UserServiceImpl;</span><br><span
                                        class="line">import com.example.demo.util.R;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span
                                        class="line">import org.springframework.web.bind.annotation.*;</span><br><span
                                        class="line"></span><br><span class="line">@RestController</span><br><span
                                        class="line">public class LogController &#123;</span><br><span class="line">  @Autowired private UserServiceImpl dservice;</span><br><span
                                        class="line">  @Autowired private Usermapper dmapper;</span><br><span
                                        class="line"></span><br><span class="line">  @ResponseBody</span><br><span
                                        class="line">  @RequestMapping(</span><br><span class="line">      value &#x3D; &quot;&#x2F;insert&quot;,</span><br><span
                                        class="line">      method &#x3D; &#123;RequestMethod.POST&#125;)</span><br><span
                                        class="line">  @SystemControllerLog(</span><br><span class="line">      module &#x3D; &quot;日志模块&quot;,</span><br><span
                                        class="line">      methods &#x3D; &quot;插入数据&quot;,</span><br><span
                                        class="line">      serviceClass &#x3D; &quot;&quot;,</span><br><span
                                        class="line">      queryMethod &#x3D; &quot;&quot;,</span><br><span
                                        class="line">      parameterType &#x3D; &quot;&quot;,</span><br><span
                                        class="line">      parameterKey &#x3D; &quot;&quot;)</span><br><span
                                        class="line">  public R insert(@RequestBody User d) &#123;</span><br><span
                                        class="line">    dmapper.insert(d);</span><br><span class="line">    return R.ok(200);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">  @ResponseBody</span><br><span
                                        class="line">  @RequestMapping(</span><br><span class="line">      value &#x3D; &quot;&#x2F;update&quot;,</span><br><span
                                        class="line">      method &#x3D; &#123;RequestMethod.POST&#125;)</span><br><span
                                        class="line">  @SystemControllerLog(</span><br><span class="line">      module &#x3D; &quot;日志模块&quot;,</span><br><span
                                        class="line">      methods &#x3D; &quot;修改数据&quot;,</span><br><span
                                        class="line">      serviceClass &#x3D; &quot;DserviceImpl&quot;,</span><br><span
                                        class="line">      queryMethod &#x3D; &quot;selectById&quot;,</span><br><span
                                        class="line">      parameterType &#x3D; &quot;int&quot;,</span><br><span
                                        class="line">      parameterKey &#x3D; &quot;id&quot;)</span><br><span
                                        class="line">  public R update(@RequestBody User d) &#123;</span><br><span
                                        class="line">    dservice.updateById(d);</span><br><span class="line">    return R.ok(200);</span><br><span
                                        class="line">  &#125;</span><br><span class="line"></span><br><span
                                        class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>12、新建最重要的部分ControllerLogAopAspect类</p>

                <figure class="highlight plain">
                    <table>
                        <tr>
                            <td class="gutter">
                                <pre><span class="line">1</span><br><span class="line">2</span><br><span
                                        class="line">3</span><br><span class="line">4</span><br><span
                                        class="line">5</span><br><span class="line">6</span><br><span
                                        class="line">7</span><br><span class="line">8</span><br><span
                                        class="line">9</span><br><span class="line">10</span><br><span
                                        class="line">11</span><br><span class="line">12</span><br><span
                                        class="line">13</span><br><span class="line">14</span><br><span
                                        class="line">15</span><br><span class="line">16</span><br><span
                                        class="line">17</span><br><span class="line">18</span><br><span
                                        class="line">19</span><br><span class="line">20</span><br><span
                                        class="line">21</span><br><span class="line">22</span><br><span
                                        class="line">23</span><br><span class="line">24</span><br><span
                                        class="line">25</span><br><span class="line">26</span><br><span
                                        class="line">27</span><br><span class="line">28</span><br><span
                                        class="line">29</span><br><span class="line">30</span><br><span
                                        class="line">31</span><br><span class="line">32</span><br><span
                                        class="line">33</span><br><span class="line">34</span><br><span
                                        class="line">35</span><br><span class="line">36</span><br><span
                                        class="line">37</span><br><span class="line">38</span><br><span
                                        class="line">39</span><br><span class="line">40</span><br><span
                                        class="line">41</span><br><span class="line">42</span><br><span
                                        class="line">43</span><br><span class="line">44</span><br><span
                                        class="line">45</span><br><span class="line">46</span><br><span
                                        class="line">47</span><br><span class="line">48</span><br><span
                                        class="line">49</span><br><span class="line">50</span><br><span
                                        class="line">51</span><br><span class="line">52</span><br><span
                                        class="line">53</span><br><span class="line">54</span><br><span
                                        class="line">55</span><br><span class="line">56</span><br><span
                                        class="line">57</span><br><span class="line">58</span><br><span
                                        class="line">59</span><br><span class="line">60</span><br><span
                                        class="line">61</span><br><span class="line">62</span><br><span
                                        class="line">63</span><br><span class="line">64</span><br><span
                                        class="line">65</span><br><span class="line">66</span><br><span
                                        class="line">67</span><br><span class="line">68</span><br><span
                                        class="line">69</span><br><span class="line">70</span><br><span
                                        class="line">71</span><br><span class="line">72</span><br><span
                                        class="line">73</span><br><span class="line">74</span><br><span
                                        class="line">75</span><br><span class="line">76</span><br><span
                                        class="line">77</span><br><span class="line">78</span><br><span
                                        class="line">79</span><br><span class="line">80</span><br><span
                                        class="line">81</span><br><span class="line">82</span><br><span
                                        class="line">83</span><br><span class="line">84</span><br><span
                                        class="line">85</span><br><span class="line">86</span><br><span
                                        class="line">87</span><br><span class="line">88</span><br><span
                                        class="line">89</span><br><span class="line">90</span><br><span
                                        class="line">91</span><br><span class="line">92</span><br><span
                                        class="line">93</span><br><span class="line">94</span><br><span
                                        class="line">95</span><br><span class="line">96</span><br><span
                                        class="line">97</span><br><span class="line">98</span><br><span
                                        class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span
                                        class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span
                                        class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span
                                        class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span
                                        class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span
                                        class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span
                                        class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span
                                        class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span
                                        class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span
                                        class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span
                                        class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span
                                        class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span
                                        class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span
                                        class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span
                                        class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span
                                        class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span
                                        class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span
                                        class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span
                                        class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span
                                        class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span
                                        class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span
                                        class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span
                                        class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span
                                        class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span
                                        class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span
                                        class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span
                                        class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span
                                        class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span
                                        class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span
                                        class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span
                                        class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span
                                        class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span
                                        class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span
                                        class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span
                                        class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span
                                        class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span
                                        class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span
                                        class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span
                                        class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span
                                        class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span
                                        class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span
                                        class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span
                                        class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span
                                        class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span
                                        class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span
                                        class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span
                                        class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span
                                        class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span
                                        class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span
                                        class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span
                                        class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span
                                        class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span
                                        class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span
                                        class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span
                                        class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br></pre>
                            </td>
                            <td class="code">
                                <pre><span class="line">import com.alibaba.fastjson.JSON;</span><br><span class="line">import com.alibaba.fastjson.JSONArray;</span><br><span
                                        class="line">import com.alibaba.fastjson.JSONObject;</span><br><span
                                        class="line">import com.example.demo.entity.Log;</span><br><span class="line">import com.example.demo.mapper.LogMapper;</span><br><span
                                        class="line">import com.example.demo.util.HttpRequestUtil;</span><br><span
                                        class="line">import com.example.demo.util.R;</span><br><span class="line">import com.example.demo.util.SpringContextUtil;</span><br><span
                                        class="line">import org.apache.commons.lang3.StringUtils;</span><br><span
                                        class="line">import org.aspectj.lang.ProceedingJoinPoint;</span><br><span
                                        class="line">import org.aspectj.lang.Signature;</span><br><span class="line">import org.aspectj.lang.annotation.Around;</span><br><span
                                        class="line">import org.aspectj.lang.annotation.Aspect;</span><br><span
                                        class="line">import org.aspectj.lang.reflect.MethodSignature;</span><br><span
                                        class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span
                                        class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span
                                        class="line">import org.springframework.core.annotation.Order;</span><br><span
                                        class="line">import org.springframework.stereotype.Component;</span><br><span
                                        class="line">import org.springframework.util.ReflectionUtils;</span><br><span
                                        class="line">import org.springframework.web.context.request.RequestContextHolder;</span><br><span
                                        class="line">import org.springframework.web.context.request.ServletRequestAttributes;</span><br><span
                                        class="line"></span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span
                                        class="line">import javax.servlet.http.HttpSession;</span><br><span
                                        class="line">import java.lang.reflect.Method;</span><br><span class="line">import java.util.Date;</span><br><span
                                        class="line">import java.util.Map;</span><br><span class="line"></span><br><span
                                        class="line">&#x2F;**</span><br><span class="line"> * 〈一句话功能简述:操作日志切面记录操作〉&lt;br&gt;</span><br><span
                                        class="line"> * 〈功能详细描述〉</span><br><span class="line"> *</span><br><span
                                        class="line"> * @see [相关类&#x2F;方法]（可选）</span><br><span class="line"> * @since [产品&#x2F;模块版本] （可选）</span><br><span
                                        class="line"> *&#x2F;</span><br><span class="line">@Component</span><br><span
                                        class="line">@Aspect</span><br><span class="line">public class ControllerLogAopAspect &#123;</span><br><span
                                        class="line"></span><br><span class="line">    private static final Logger LOGGER &#x3D; LoggerFactory.getLogger(ControllerLogAopAspect.class);</span><br><span
                                        class="line"></span><br><span class="line">    &#x2F;&#x2F; 注入service,用来将日志信息保存在数据库</span><br><span
                                        class="line">    @Autowired</span><br><span class="line">    private LogMapper logservice;</span><br><span
                                        class="line"></span><br><span class="line"></span><br><span class="line">    @SuppressWarnings(&#123;&quot;rawtypes&quot;, &quot;unused&quot;&#125;)</span><br><span
                                        class="line">    @Order(1)</span><br><span class="line">    &#x2F;&#x2F; 配置接入点,如果不知道怎么配置,可以百度一下规则　</span><br><span
                                        class="line">    @Around(&quot;execution(* com.example.demo.controller..*(..))&quot;)</span><br><span
                                        class="line">    public Object around(ProceedingJoinPoint proceedingJoinPoint) throws Throwable &#123;</span><br><span
                                        class="line">        &#x2F;&#x2F; 常见日志实体对象</span><br><span class="line">        Log log &#x3D; new Log();</span><br><span
                                        class="line">        &#x2F;&#x2F; 获取登录用户账户</span><br><span class="line">        HttpServletRequest httpRequest &#x3D; ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span
                                        class="line"></span><br><span class="line">        &#x2F;&#x2F; 方法通知前获取时间,为什么要记录这个时间呢？当然是用来计算模块执行时间的</span><br><span
                                        class="line">        long startTime &#x3D; System.currentTimeMillis();</span><br><span
                                        class="line">        log.setStartTime(new Date());</span><br><span
                                        class="line"></span><br><span class="line">        &#x2F;&#x2F; 拦截的实体类，就是当前正在执行的controller</span><br><span
                                        class="line">        Object target &#x3D; proceedingJoinPoint.getTarget();</span><br><span
                                        class="line">        &#x2F;&#x2F; 拦截的方法名称。当前正在执行的方法</span><br><span
                                        class="line">        String methodName &#x3D; proceedingJoinPoint.getSignature().getName();</span><br><span
                                        class="line">        &#x2F;&#x2F; 拦截的方法参数</span><br><span class="line">        Object[] args &#x3D; proceedingJoinPoint.getArgs();</span><br><span
                                        class="line">        JSONArray operateParamArray &#x3D; new JSONArray();</span><br><span
                                        class="line">        for (int i &#x3D; 0; i &lt; args.length; i++) &#123;</span><br><span
                                        class="line">            Object paramsObj &#x3D; JSON.toJSONString(args[i]);</span><br><span
                                        class="line">            &#x2F;&#x2F; 通过该方法可查询对应的object属于什么类型：String type &#x3D; paramsObj.getClass().getName();</span><br><span
                                        class="line">            if (paramsObj instanceof String || paramsObj instanceof JSONObject) &#123;</span><br><span
                                        class="line">                String str &#x3D; (String) paramsObj;</span><br><span
                                        class="line">                &#x2F;&#x2F; 将其转为jsonobject</span><br><span
                                        class="line">                JSONObject dataJson &#x3D; JSONObject.parseObject(str);</span><br><span
                                        class="line">                if (dataJson &#x3D;&#x3D; null || dataJson.isEmpty() || &quot;null&quot;.equals(dataJson)) &#123;</span><br><span
                                        class="line">                    break;</span><br><span class="line">                &#125; else &#123;</span><br><span
                                        class="line">                    operateParamArray.add(dataJson);</span><br><span
                                        class="line">                &#125;</span><br><span class="line">            &#125; else if (paramsObj instanceof Map) &#123;</span><br><span
                                        class="line">                &#x2F;&#x2F; get请求，以map类型传参</span><br><span
                                        class="line">                Map&lt;String, Object&gt; map &#x3D; (Map&lt;String, Object&gt;) paramsObj;</span><br><span
                                        class="line">                JSONObject json &#x3D; new JSONObject(map);</span><br><span
                                        class="line">                operateParamArray.add(json);</span><br><span
                                        class="line">            &#125;</span><br><span
                                        class="line">        &#125;</span><br><span class="line">        &#x2F;&#x2F; 拦截的参数类型</span><br><span
                                        class="line">        Signature sig &#x3D; proceedingJoinPoint.getSignature();</span><br><span
                                        class="line">        MethodSignature msig &#x3D; null;</span><br><span
                                        class="line">        if (!(sig instanceof MethodSignature)) &#123;</span><br><span
                                        class="line">            throw new IllegalArgumentException(&quot;该注解只能用于方法&quot;);</span><br><span
                                        class="line">        &#125;</span><br><span class="line">        msig &#x3D; (MethodSignature) sig;</span><br><span
                                        class="line"></span><br><span class="line">        Class[] parameterTypes &#x3D; msig.getMethod().getParameterTypes();</span><br><span
                                        class="line">        Object object &#x3D; null;</span><br><span class="line">        &#x2F;&#x2F; 获得被拦截的方法</span><br><span
                                        class="line">        Method method &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span
                                        class="line">            method &#x3D; target.getClass().getMethod(methodName, parameterTypes);</span><br><span
                                        class="line">        &#125; catch (NoSuchMethodException e1) &#123;</span><br><span
                                        class="line">            ControllerLogAopAspect.LOGGER.error(&quot;ControllerLogAopAspect around error&quot;, e1);</span><br><span
                                        class="line">        &#125; catch (SecurityException e1) &#123;</span><br><span
                                        class="line">            ControllerLogAopAspect.LOGGER.error(&quot;ControllerLogAopAspect around error&quot;, e1);</span><br><span
                                        class="line">        &#125;</span><br><span class="line">        if (null !&#x3D; method) &#123;</span><br><span
                                        class="line">            &#x2F;&#x2F; 判断是否包含自定义的注解，说明一下这里的SystemLog就是我自己自定义的注解</span><br><span
                                        class="line">            if (method.isAnnotationPresent(SystemControllerLog.class)) &#123;</span><br><span
                                        class="line">                HttpSession httpSession &#x3D; httpRequest.getSession(true);</span><br><span
                                        class="line">                log.setUserId(211);  &#x2F;&#x2F; 该数据为测试数据</span><br><span
                                        class="line">                log.setUserName(&quot;程序猿&quot;);  &#x2F;&#x2F; 该数据为测试数据</span><br><span
                                        class="line"></span><br><span class="line">                SystemControllerLog systemlog &#x3D; method.getAnnotation(SystemControllerLog.class);</span><br><span
                                        class="line"></span><br><span class="line">                &#x2F;&#x2F; 请求查询操作前数据的spring bean</span><br><span
                                        class="line">                String serviceClass &#x3D; systemlog.serviceClass();</span><br><span
                                        class="line">                &#x2F;&#x2F; 请求查询数据的方法</span><br><span
                                        class="line">                String queryMethod &#x3D; systemlog.queryMethod();</span><br><span
                                        class="line">                &#x2F;&#x2F; 设置调用模块和方法</span><br><span
                                        class="line">                log.setModule(systemlog.module());</span><br><span
                                        class="line">                log.setMethod(systemlog.methods());</span><br><span
                                        class="line">                log.setUserIp(HttpRequestUtil.getIpAddr(httpRequest));</span><br><span
                                        class="line">                &#x2F;&#x2F; 设置请求参数</span><br><span class="line">                log.setOperateParams(operateParamArray.toJSONString());</span><br><span
                                        class="line"></span><br><span class="line">                &#x2F;&#x2F; 判断是否需要进行操作前的对象参数查询</span><br><span
                                        class="line">                if (StringUtils.isNotBlank(systemlog.parameterKey())</span><br><span
                                        class="line">                        &amp;&amp; StringUtils.isNotBlank(systemlog.parameterType())</span><br><span
                                        class="line">                        &amp;&amp; StringUtils.isNotBlank(systemlog.queryMethod())</span><br><span
                                        class="line">                        &amp;&amp; StringUtils.isNotBlank(systemlog.serviceClass())) &#123;</span><br><span
                                        class="line">                    boolean isArrayResult &#x3D; systemlog.paramIsArray();</span><br><span
                                        class="line">                    &#x2F;&#x2F; 参数类型</span><br><span class="line">                    String paramType &#x3D; systemlog.parameterType();</span><br><span
                                        class="line">                    String key &#x3D; systemlog.parameterKey();</span><br><span
                                        class="line"></span><br><span class="line">                    if (isArrayResult) &#123; &#x2F;&#x2F; 批量操作</span><br><span
                                        class="line">                        &#x2F;&#x2F; 从请求的参数中解析出查询key对应的value值</span><br><span
                                        class="line">                        String value &#x3D; &quot;&quot;;</span><br><span
                                        class="line">                        JSONArray beforeParamArray &#x3D; new JSONArray();</span><br><span
                                        class="line">                        for (int i &#x3D; 0; i &lt; operateParamArray.size(); i++) &#123;</span><br><span
                                        class="line">                            JSONObject params &#x3D; operateParamArray.getJSONObject(i);</span><br><span
                                        class="line">                            JSONArray paramArray &#x3D; (JSONArray) params.get(key);</span><br><span
                                        class="line">                            if (paramArray !&#x3D; null) &#123;</span><br><span
                                        class="line">                                for (int j &#x3D; 0; j &lt; paramArray.size(); j++) &#123;</span><br><span
                                        class="line">                                    String paramId &#x3D; paramArray.getString(j);</span><br><span
                                        class="line">                                    &#x2F;&#x2F; 在此处判断spring bean查询的方法参数类型</span><br><span
                                        class="line">                                    Object data &#x3D; getOperateBeforeData(paramType, serviceClass, queryMethod, paramId);</span><br><span
                                        class="line">                                    JSONObject json &#x3D; (JSONObject) JSON.toJSON(data);</span><br><span
                                        class="line">                                    beforeParamArray.add(json);</span><br><span
                                        class="line">                                &#125;</span><br><span
                                        class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span
                                        class="line">                        log.setBeforeParams(beforeParamArray.toJSONString());</span><br><span
                                        class="line">                    &#125; else &#123; &#x2F;&#x2F; 单量操作</span><br><span
                                        class="line">                        &#x2F;&#x2F; 从请求的参数中解析出查询key对应的value值</span><br><span
                                        class="line">                        String value &#x3D; &quot;&quot;;</span><br><span
                                        class="line">                        for (int i &#x3D; 0; i &lt; operateParamArray.size(); i++) &#123;</span><br><span
                                        class="line">                            JSONObject params &#x3D; operateParamArray.getJSONObject(i);</span><br><span
                                        class="line">                            value &#x3D; params.getString(key);</span><br><span
                                        class="line">                            if (StringUtils.isNotBlank(value)) &#123;</span><br><span
                                        class="line">                                break;</span><br><span
                                        class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span
                                        class="line">                        &#x2F;&#x2F; 在此处获取操作前的spring bean的查询方法</span><br><span
                                        class="line">                        Object data &#x3D; getOperateBeforeData(paramType, serviceClass, queryMethod, value);</span><br><span
                                        class="line">                        JSONObject beforeParam &#x3D; (JSONObject) JSON.toJSON(data);</span><br><span
                                        class="line">                        log.setBeforeParams(beforeParam.toJSONString());</span><br><span
                                        class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span
                                        class="line"></span><br><span class="line">                long entTime &#x3D; System.currentTimeMillis();</span><br><span
                                        class="line">                try &#123;</span><br><span class="line">                    &#x2F;&#x2F; 执行页面请求模块方法，并返回</span><br><span
                                        class="line">                    object &#x3D; proceedingJoinPoint.proceed();</span><br><span
                                        class="line">                    &#x2F;&#x2F; 获取系统时间</span><br><span
                                        class="line">                    log.setEndTime(new Date());</span><br><span
                                        class="line">                    &#x2F;&#x2F; 将object 转化为controller封装返回的实体类：RequestResult</span><br><span
                                        class="line">                    R requestResult &#x3D; (R) object;</span><br><span
                                        class="line">                    Object code &#x3D; requestResult.get(&quot;code&quot;);</span><br><span
                                        class="line">                    if (Integer.parseInt(code.toString()) &#x3D;&#x3D; 200) &#123;</span><br><span
                                        class="line">                        &#x2F;&#x2F; 操作流程成功</span><br><span
                                        class="line">                        log.setResultStatus(200);</span><br><span
                                        class="line">                        log.setResultMsg(&quot;执行成功&quot;);</span><br><span
                                        class="line">                    &#125; else &#123;</span><br><span
                                        class="line">                        log.setResultStatus(500);</span><br><span
                                        class="line">                        log.setResultMsg(&quot;失败&quot;);</span><br><span
                                        class="line">                    &#125;</span><br><span class="line">                    log.setTime(String.valueOf(entTime - startTime));</span><br><span
                                        class="line"></span><br><span class="line">                    &#x2F;&#x2F; 保存进数据库</span><br><span
                                        class="line">                    logservice.insert(log);</span><br><span
                                        class="line">                &#125; catch (Throwable e) &#123;</span><br><span
                                        class="line">                    log.setEndTime(new Date());</span><br><span
                                        class="line">                    log.setResultStatus(500);</span><br><span
                                        class="line">                    System.out.println(e.toString());</span><br><span
                                        class="line">                    log.setResultMsg(e.getMessage());</span><br><span
                                        class="line">                    log.setTime(String.valueOf(entTime - startTime));</span><br><span
                                        class="line"></span><br><span class="line">                    logservice.insert(log);</span><br><span
                                        class="line">                &#125;</span><br><span class="line">            &#125; else &#123;</span><br><span
                                        class="line">                &#x2F;&#x2F; 没有包含注解</span><br><span class="line">                object &#x3D; proceedingJoinPoint.proceed();</span><br><span
                                        class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span
                                        class="line">            &#x2F;&#x2F; 不需要拦截直接执行</span><br><span class="line">            object &#x3D; proceedingJoinPoint.proceed();</span><br><span
                                        class="line">        &#125;</span><br><span
                                        class="line">        return object;</span><br><span
                                        class="line">    &#125;</span><br><span class="line"></span><br><span
                                        class="line">    &#x2F;**</span><br><span
                                        class="line">     * 功能描述: &lt;br&gt;</span><br><span class="line">     * 〈功能详细描述〉</span><br><span
                                        class="line">     *</span><br><span
                                        class="line">     * @param paramType:参数类型</span><br><span class="line">     * @param serviceClass：bean名称</span><br><span
                                        class="line">     * @param queryMethod：查询method</span><br><span class="line">     * @param value：查询id的value</span><br><span
                                        class="line">     * @return</span><br><span class="line">     * @see [相关类&#x2F;方法](可选)</span><br><span
                                        class="line">     * @since [产品&#x2F;模块版本](可选)</span><br><span class="line">     *&#x2F;</span><br><span
                                        class="line">    public Object getOperateBeforeData(</span><br><span
                                        class="line">            String paramType, String serviceClass, String queryMethod, String value) &#123;</span><br><span
                                        class="line">        Object obj &#x3D; new Object();</span><br><span
                                        class="line">        &#x2F;&#x2F; 在此处解析请求的参数类型，根据id查询数据，id类型有四种：int，Integer,long,Long</span><br><span
                                        class="line">        if (paramType.equals(&quot;int&quot;)) &#123;</span><br><span
                                        class="line">            int id &#x3D; Integer.parseInt(value);</span><br><span
                                        class="line">            Method mh &#x3D;</span><br><span class="line">                    ReflectionUtils.findMethod(</span><br><span
                                        class="line">                            SpringContextUtil.getBean(serviceClass).getClass(), queryMethod, int.class);</span><br><span
                                        class="line">            &#x2F;&#x2F; 用spring bean获取操作前的参数,此处需要注意：传入的id类型与bean里面的参数类型需要保持一致</span><br><span
                                        class="line">            obj &#x3D; ReflectionUtils.invokeMethod(mh, SpringContextUtil.getBean(serviceClass), id);</span><br><span
                                        class="line">        &#125; else if (paramType.equals(&quot;Integer&quot;)) &#123;</span><br><span
                                        class="line">            Integer id &#x3D; Integer.valueOf(value);</span><br><span
                                        class="line">            Method mh &#x3D;</span><br><span class="line">                    ReflectionUtils.findMethod(</span><br><span
                                        class="line">                            SpringContextUtil.getBean(serviceClass).getClass(), queryMethod, Integer.class);</span><br><span
                                        class="line">            &#x2F;&#x2F; 用spring bean获取操作前的参数,此处需要注意：传入的id类型与bean里面的参数类型需要保持一致</span><br><span
                                        class="line">            obj &#x3D; ReflectionUtils.invokeMethod(mh, SpringContextUtil.getBean(serviceClass), id);</span><br><span
                                        class="line"></span><br><span class="line">        &#125; else if (paramType.equals(&quot;long&quot;)) &#123;</span><br><span
                                        class="line">            long id &#x3D; Long.parseLong(value);</span><br><span
                                        class="line">            Method mh &#x3D;</span><br><span class="line">                    ReflectionUtils.findMethod(</span><br><span
                                        class="line">                            SpringContextUtil.getBean(serviceClass).getClass(), queryMethod, long.class);</span><br><span
                                        class="line">            &#x2F;&#x2F; 用spring bean获取操作前的参数,此处需要注意：传入的id类型与bean里面的参数类型需要保持一致</span><br><span
                                        class="line">            obj &#x3D; ReflectionUtils.invokeMethod(mh, SpringContextUtil.getBean(serviceClass), id);</span><br><span
                                        class="line"></span><br><span class="line">        &#125; else if (paramType.equals(&quot;Long&quot;)) &#123;</span><br><span
                                        class="line">            Long id &#x3D; Long.valueOf(value);</span><br><span
                                        class="line">            Method mh &#x3D;</span><br><span class="line">                    ReflectionUtils.findMethod(</span><br><span
                                        class="line">                            SpringContextUtil.getBean(serviceClass).getClass(), queryMethod, Long.class);</span><br><span
                                        class="line">            &#x2F;&#x2F; 用spring bean获取操作前的参数,此处需要注意：传入的id类型与bean里面的参数类型需要保持一致</span><br><span
                                        class="line">            obj &#x3D; ReflectionUtils.invokeMethod(mh, SpringContextUtil.getBean(serviceClass), id);</span><br><span
                                        class="line">        &#125;</span><br><span
                                        class="line">        return obj;</span><br><span
                                        class="line">    &#125;</span><br><span class="line">    </span><br><span
                                        class="line">&#125;</span><br></pre>
                            </td>
                        </tr>
                    </table>
                </figure>

                <p class='p small'>13、启动项目使用Postman调取LogController中写好的接口</p>

                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C.png"
                        alt=""></p>
                <p class='p small'>我们可以看到返回了success 200 ，去看mysql数据库中是否成功的插入了数据和日志操作</p>

                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5Mysql.png"
                        alt=""></p>
                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5mysql02.png"
                        alt=""></p>
                <p class='p small'>接下来调用update接口</p>

                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5%E6%93%8D%E4%BD%9C02.png"
                        alt=""></p>
                <p class='p small'>再继续查看数据库是否更新了数据</p>

                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5mysql03.png"
                        alt=""></p>
                <p><img src="/img/loading.gif"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/AOP%E6%97%A5%E5%BF%97%E6%93%8D%E4%BD%9C/%E6%97%A5%E5%BF%97%E6%8F%92%E5%85%A5mysql04.png"
                        alt=""></p>
                <p class='p small'>我们可以看到记录了操作前的数据和传递过来的参数，至此，使用切面记录日志操作就到此结束了！</p>

                <br/>

                <h2 id="联系博主"><a href="#联系博主" class="headerlink" title="联系博主"></a>联系博主</h2>
                <div class="btns circle center grid5">
                    <a href=''>
                        <i class="fa fa-apple"></i>
                        <b>微信</b>

                        <img src="/img/loading.gif"
                             data-src='https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/%E5%8D%9A%E4%B8%BB%E5%BE%AE%E4%BF%A1.png'>

                    </a>

                    <a href=''>
                        <i class="fa fa-apple"></i>
                        <b>公众号</b>
                        <img src="/img/loading.gif"
                             data-src='https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7%E4%BA%8C%E7%BB%B4%E7%A0%81.jpg'>
                    </a>
                </div>
            </div>
            <div class="post-copyright">
                <div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span
                        class="post-copyright-info"><a href="mailto:undefined">Hello World攻城狮</a></span></div>
                <div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span
                        class="post-copyright-info"><a
                        href="http://www.ljc.cn.com/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/">http://www.ljc.cn.com/2021/07/28/AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97/</a></span>
                </div>
                <div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span
                        class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a
                        href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a
                        href="http://www.ljc.cn.com" target="_blank">LJC’sBlog</a>！</span></div>
            </div>
            <div class="tag_share">
                <div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Spring/">Spring</a>
                </div>
                <div class="post_share">
                    <div class="addthis_inline_share_toolbox"></div>
                    <script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=null" async="async"></script>
                </div>
            </div>
            <div class="post-reward">
                <button class="reward-button" type="button"><i class="fas fa-qrcode"></i> 打赏
                    <div class="reward-main">
                        <ul class="reward-all">
                            <li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg"
                                                         alt="wechat"
                                                         onclick="window.open('/img/wechat.jpg')"/>
                                <div class="post-qr-code__desc">wechat</div>
                            </li>
                        </ul>
                    </div>
                </button>
            </div>
            <nav class="pagination-post" id="pagination">
                <div class="prev-post pull-left"><a
                        href="/2021/07/31/OpenFeign%E7%9A%84%E4%BD%BF%E7%94%A8/"><img class="prev-cover"
                                                                                               data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/cover/bg18.jpg"
                                                                                               onerror="onerror=null;src='/img/404.jpg'">
                    <div class="pagination-info">
                        <div class="label">上一篇</div>
                        <div class="prev_info">OpenFeign的使用</div>
                    </div>
                </a></div>
                <div class="next-post pull-right"><a
                        href="/2021/07/28/Nacos%E6%8C%81%E4%B9%85%E5%8C%96%E9%85%8D%E7%BD%AE/"><img
                        class="next-cover"
                        data-src="https://lu-jia-chen.oss-cn-beijing.aliyuncs.com/lujiachen/cover/bg15.jpg"
                        onerror="onerror=null;src='/img/404.jpg'">
                    <div class="pagination-info">
                        <div class="label">下一篇</div>
                        <div class="next_info">Nacos持久化配置</div>
                    </div>
                </a></div>
            </nav>
            <hr>
            <div id="post-comment">
                <div class="comment-head">
                    <div class="comment-headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div>
                </div>
                <div class="comment-wrap">
                    <div class="comments-items-1" data-name="Valine">
                        <div class="vcomment" id="vcomment"></div>
                        <script>function loadvaline() {
                            var requestSetting = function (from, set) {
                                var from = from
                                var setting = set.split(',').filter(function (item) {
                                    return from.indexOf(item) > -1
                                });
                                setting = setting.length == 0 ? from : setting;
                                return setting
                            }

                            var guestInfo = requestSetting(['nick', 'mail', 'link'], 'nick,mail,link')
                            var requiredFields = requestSetting(['nick', 'mail'], 'nick,mail')

                            function initValine() {
                                window.valine = new Valine({
                                    el: '#vcomment',
                                    appId: 'hzI4aFPUvrMgxa6AcgvKGw5z-MdYXbMMI',
                                    appKey: 'Op31Q58se1JWIr2dJUBIyKQX',
                                    placeholder: '请留下你的姓名',
                                    avatar: 'monsterid',
                                    meta: guestInfo,
                                    pageSize: '7',
                                    lang: 'zh-CN',
                                    recordIP: true,
                                    serverURLs: '',
                                    emojiCDN: '',
                                    emojiMaps: "",
                                    enableQQ: true,
                                    requiredFields: requiredFields
                                });
                            }

                            loadScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
                        }

                        if ('Valine' === 'Valine' || false) {
                            window.addEventListener('load', loadvaline)
                        } else {
                            function loadOtherComment() {
                                loadvaline()
                            }
                        }</script>
                    </div>
                </div>
            </div>
        </article>
    </main>
    <footer id="footer" data-type="color">
        <div id="footer-wrap">
            <div class="copyright">&copy;2020 - 2021 By Hello World攻城狮</div>
            <div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span
                    class="footer-separator">|</span><span>主题 </span><a
                    href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a>
            </div>
        </div>
    </footer>
</div>
<section id="rightside">
    <div id="rightside-config-hide">
        <button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button>
        <button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button>
        <button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button>
        <button id="translateLink" type="button" title="简繁转换">繁</button>
        <button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button>
    </div>
    <div id="rightside-config-show">
        <button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button>
        <a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a>
        <button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button>
        <button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button>
    </div>
</section>
<div class="search-dialog" id="algolia-search">
    <div class="search-dialog__title" id="algolia-search-title">Algolia</div>
    <div id="algolia-input-panel">
        <div id="algolia-search-input"></div>
    </div>
    <hr/>
    <div id="algolia-search-results">
        <div id="algolia-hits"></div>
        <div id="algolia-pagination"></div>
        <div id="algolia-stats"></div>
    </div>
    <span class="search-close-button"><i class="fas fa-times"></i></span></div>
<div class="search-mask"></div>
<script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/main.js"></script>
<script src="/js/tw_cn.js"></script>
<script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script>
<script id="ribbon_piao" mobile="true" src="/js/third-party/piao.js"></script>
<script src="/js/third-party/activate-power-mode.js"></script>
<script>POWERMODE.colorful = true;
POWERMODE.shake = true;
document.body.addEventListener('input', POWERMODE);
</script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script>
<script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script>
<script>document.addEventListener('DOMContentLoaded', function () {
    pangu.autoSpacingPage()
})</script>
<script src="/js/search/algolia.js"></script>
<script src="/js/VolantisTags.js"></script>
<script src="/js/volantis.js"></script>
<script defer src="/live2d-widget/autoload.js"></script>
<script>var endLoading = function () {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load', endLoading)</script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script>
<script>L2Dwidget.init({
    "model": {"jsonPath": "/live2dw/assets/haruto.model.json"},
    "display": {"position": "lift", "width": 150, "height": 300},
    "mobile": {"show": false},
    "log": false,
    "pluginJsPath": "lib/",
    "pluginModelPath": "assets/",
    "pluginRootPath": "live2dw/",
    "tagMode": false
});</script>
<script async>window.onload = function () {
    var a = document.createElement('script'), b = document.getElementsByTagName('script')[0];
    a.type = 'text/javascript', a.async = !0, a.src = '/sw-register.js?v=' + Date.now(), b.parentNode.insertBefore(a, b)
};</script>
</body>
</html>
